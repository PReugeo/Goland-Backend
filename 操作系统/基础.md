参考自https://github.com/CyC2018/CS-Notes 

# 基本特征

##　并发

并发是指一段时间内同时运行多个程序

并行同一时刻运行多个指令 ( 需要硬件支持 )

## 共享

共享是指系统中的资源可以被多个并发进程共同使用.

两种共享方式:互斥共享 ( 需要同步机制来实现互斥访问 ) 和同时共享

## 虚拟

将一个物理实体转换成多个逻辑实体

主要有两种虚拟技术: 时分复用和空分复用

多进程并发执行使用了时分复用技术.

虚拟内存使用了空分复用技术,  它将物理内存抽象为地址空间，每个进程都有各自的地址空间。地址空间的页被映射到物理内存，地址空间的页并不需要全部在物理内存中，当使用到一个没有在物理内存的页时，执行页面置换算法，将该页置换到内存中。 

## 异步

指进程不是一次性完成而是走走停停

## 中断分类

1. 外中断: 由 CPU 执行指令以外的时间引起
2. 异常: 由 CPU 执行指令的内部时间引起, 如非法操作码, 地址越界, 算术溢出等
3. 陷入: 在用户程序中使用程序调用

# 进程、线程与协程

## 进程

进程时资源分配的基本单位（ 最小资源管理单元 ）

## 线程

线程是独立调度的基本单位（ 最小执行单元 ）

## 协程

 **协程是一种用户态的轻量级线程，**协程的调度完全由用户控制。协程拥有自己的寄存器上下文和栈。协程调度切换时，将寄存器上下文和栈保存到其他地方，在切回来的时候，恢复先前保存的寄存器上下文和栈，直接操作栈则基本没有内核切换的开销，可以不加锁的访问全局变量，所以上下文的切换非常快。 

## 进程与线程的区别

1. 线程不拥有资源, 线程可以访问隶属于进程的资源
2. 调度: 同一进程, 线程切换不会引起进程转换, 不同进程的线程切换会引起进程切换
3. 系统开销: 进程大, 线程小
4. 通信方面: 线程间可以通过直接读写同一进程中的数据进行通信, 进程间的通信需要借助 IPC ( 进程间通信 )

## 协程和线程的区别

协程多与线程进行比较

1) 一个线程可以多个协程，一个进程也可以单独拥有多个协程，这样python中则能使用多核CPU。

2) 线程进程都是同步机制，而协程则是异步

3) 协程能保留上一次调用时的状态，每次过程重入时，就相当于进入上一次调用的状态

## 进程状态的切换

![img](..\java\static\进程状态.png)



# 进程调度算法

## 1. 批处理系统

 批处理系统没有太多的用户操作，在该系统中，调度算法目标是保证吞吐量和周转时间（从提交到终止的时间）。 

1. 先来先服务 ( FCFS first-come firse-serverd ):

    1. 非抢占式调度算法发, 按照请求顺序进行调度
    2. 有利于长作业, 不利于短作业

2. 短作业优先 ( SJF shortest job first )

    1. 非抢占式, 按估计时间最短顺序进行调度
    2. 长作业可能饿死

3. 最短剩余时间优先 ( SRTN  **shortest remaining time next**  )

    1. 抢占式调度算法, 按剩余时间进行调度
    2.  最短作业优先的抢占式版本，按剩余运行时间的顺序进行调度。 

    

## 2. 交互式系统

 交互式系统有大量的用户交互操作，在该系统中调度算法的目标是快速地进行响应。 

1. 时间片轮转
    1.  将所有就绪进程按 FCFS 的原则排成一个队列，每次调度时，把 CPU 时间分配给队首进程，该进程可以执行一个时间片。当时间片用完时，由计时器发出时钟中断，调度程序便停止该进程的执行，并将它送往就绪队列的末尾，同时继续把 CPU 时间分配给队首的进程。 
    2. 效率与时间片大小由很大关系
2. 优先级调度
    1. 给每个进程分配一个优先级, 按优先级进行调度
    2. 为了防止低优先级的进程永远等不到调度, 可以随着时间的推移增加等待进程的优先级
3. 多级反馈队列
    1. 相当于 1 + 2



## 3. 实时系统

实时系统要求一个请求在一个确定时间内得到响应。

分为硬实时和软实时，前者必须满足绝对的截止时间，后者可以容忍一定的超时。



# 进程同步

## 1. 临界区

对临界资源进行访问的代码块. 为了互斥访问临界资源, 每个进程进入临界区之前要先进行检查



## 2. 同步和互斥

* 同步: 多个进程因为合作产生的直接制约关系, 使进程有一定先后执行关系
* 互斥: 多个进程在同一时刻只有一个能进入临界区



## 3. 信号量

信号量（Semaphore）是一个整型变量，可以对其执行 down 和 up 操作，也就是常见的 P 和 V 操作。

- **down** : 如果信号量大于 0 ，执行 -1 操作；如果信号量等于 0，进程睡眠，等待信号量大于 0；
- **up** ：对信号量执行 +1 操作，唤醒睡眠的进程让其完成 down 操作。

down 和 up 操作需要被设计成原语，不可分割，通常的做法是在执行这些操作的时候屏蔽中断。

如果信号量的取值只能为 0 或者 1，那么就成为了 **互斥量（Mutex）** ，0 表示临界区已经加锁，1 表示临界区解锁。

# 进程通信 ( IPC )

- 进程同步：控制多个进程按一定顺序执行；
- 进程通信：进程间传输信息。

进程通信是一种手段，而进程同步是一种目的。也可以说，为了能够达到进程同步的目的，需要让进程进行通信，传输一些进程同步所需要的信息。



## 1. 管道 ( pipe )

1. 只支持半双工通信( 单向交替传输 )
2. 只能在父子进程或兄弟进程中使用



## 2. 命名管道 ( FIFO )

去除了管道只能在父子进程中使用的限制

FIFO 常用于客户-服务器引用程序中, FIFO 用作汇聚点, 在客户进程和服务器进程之间传递数据.

![img](%E5%9F%BA%E7%A1%80.assets/FIFO.png)



## 3. 消息队列

1. 可以独立读写进程存在, 从而避免了 FIFO 中同步管道的打开和关闭时可能产生的困难
2. 避免 FIFO 同步阻塞问题, 不需要进程自己的同步方法
3. 读进程可以根据消息类型有选择的接受, 而非 FIFO 那样默认接收.



## 4. 信号量

一个计数器, 为多进程提供对共享数据对象的访问



## 5. 共享存储

允许多进程共享一个给定的存储区, 需要信号量来同步对共享存储的访问, 是最快的 IPC.



## 6. 套接字 ( Socket )

可用于不同机器间的进程通信